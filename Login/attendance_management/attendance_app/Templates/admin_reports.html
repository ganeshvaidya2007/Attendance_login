{% extends "admin_base.html" %}

{% block title %}Reports{% endblock %}

{% block extra_css %}
<style>
    .head { display:flex; justify-content:space-between; align-items:center; gap:12px; flex-wrap:wrap; }
    .head h1 { margin:0; font-size:42px; }
    .head p { margin:6px 0 0; color:#64748b; font-size:26px; }
    .btn { border:1px solid #dbe3f2; border-radius:8px; background:#fff; padding:10px 14px; font-size:22px; }
    .kpi {
        margin-top:14px; display:grid; grid-template-columns: repeat(3, 1fr); gap:12px;
    }
    .card { background:#fff; border:1px solid #e8edf7; border-radius:12px; padding:14px; }
    .small { color:#64748b; font-size:20px; }
    .big { font-size:50px; font-weight:700; margin-top:8px; }
    .green { color:#2fb573; }
    .red { color:#dc2626; }
    .blue { color:#2f6fed; }
    .section { margin-top:14px; background:#fff; border:1px solid #e8edf7; border-radius:12px; padding:14px; }
    .section h3 { margin:0 0 12px; font-size:34px; }
    .bars { display:grid; grid-template-columns: repeat(5, 1fr); gap:10px; align-items:end; min-height:160px; }
    .bar { width:28px; margin:0 auto; border-radius:5px 5px 0 0; background:#2f6fed; }
    .bar.red { background:#ef4444; }
    .bar-label { text-align:center; margin-top:6px; color:#64748b; font-size:20px; }
    table { width:100%; border-collapse:collapse; font-size:22px; }
    th, td { padding:10px; border-bottom:1px solid #edf2fb; text-align:left; }
    th { color:#64748b; }
    .status { border-radius:999px; padding:4px 8px; font-size:18px; display:inline-block; }
    .critical { color:#dc2626; background:#fee2e2; }
    .warning { color:#b45309; background:#fef3c7; }
    @media (max-width:1100px) {
        .kpi { grid-template-columns:1fr; }
        .bars { grid-template-columns: repeat(2, 1fr); }
    }
</style>
{% endblock %}

{% block content %}
<div class="head">
    <div>
        <h1>Reports</h1>
        <p>Analyze attendance trends and export data.</p>
    </div>
    <button class="btn" type="button">Download PDF</button>
</div>

<section class="kpi">
    <article class="card">
        <div class="small">MONTHLY AVERAGE</div>
        <div class="big">{{ monthly_average }}%</div>
        <div class="small green">+ 1.2% from last month</div>
    </article>
    <article class="card">
        <div class="small">CRITICAL ATTENDANCE</div>
        <div class="big red">{{ critical_attendance }}</div>
        <div class="small">Students below 75%</div>
    </article>
    <article class="card">
        <div class="small">BEST CLASS</div>
        <div class="big blue">{{ best_class }}</div>
        <div class="small">{{ best_class_avg }}% average attendance</div>
    </article>
</section>

<section class="section">
    <h3>Subject-wise Breakdown</h3>
    <div class="bars">
        {% for item in subject_breakdown %}
            <div>
                <div class="bar {% if item.subject == 'Operating Systems' %}red{% endif %}" style="height:{{ item.value }}%;"></div>
                <div class="bar-label">{{ item.subject }}</div>
            </div>
        {% endfor %}
    </div>
</section>

<section class="section">
    <h3>Shortage List (&lt; 75%)</h3>
    <table>
        <thead>
            <tr>
                <th>STUDENT NAME</th>
                <th>USN</th>
                <th>ATTENDANCE %</th>
                <th>STATUS</th>
            </tr>
        </thead>
        <tbody>
            {% for item in shortage %}
                <tr>
                    <td>{{ item.student.name }}</td>
                    <td>{{ item.student.usn }}</td>
                    <td>{{ item.attendance_pct }}%</td>
                    <td>
                        {% if item.attendance_pct < 65 %}
                            <span class="status critical">Critical</span>
                        {% else %}
                            <span class="status warning">Warning</span>
                        {% endif %}
                    </td>
                </tr>
            {% empty %}
                <tr><td colspan="4">No shortage students found.</td></tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% endblock %}
